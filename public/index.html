<!DOCTYPE html>
<html>
  <head>
    <title>Lucidity</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <h1>Lucidity</h1>
    <h5 id="count">Ask questions with 0 other users!</h5>
    <div id="textcontainer">
      <textarea id="query" cols=80 rows=6 placeholder="Type here"></textarea><input id="send" type="submit" value="Ask!">
    </div>
    <div id="stream">
    </div>
    <script src="jquery-1.10.2.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io.connect('http://localhost');

      var message1 = "<div class='message1' id=";
      var message2 = "<div class='message2' id=";
      var admin = "<div class='admin' id=";
      var middle = "><p>";
      var close = "</p></div>";

      var count1 = "Ask questions with ";
      var count2 = " other users!";
      var countSingle = " other user!";

      var bool = true;

      $('#send').on('click', function(e) {
        e.preventDefault();
        if ($('#query').val()) {
          socket.emit('query', {
            content: $('#query').val()
          });
          $('#query').val('');
        }
      });
      socket.on('update', function (data) {
        if (data.admin) {
          $('#stream').prepend(admin + data.id + middle + close);
          $('#'+data.id+' p').text(data.content);
          if (data.users === 1) {
            $('#count').text(count1 + data.users + countSingle);
          }
          else {
            $('#count').text(count1 + data.users + count2);
          }
        }
        else if (bool) {
          $('#stream').prepend(message1 + data.id + middle + close);
          $('#'+data.id+' p').text(data.content);
          if (data.users === 1) {
            $('#count').text(count1 + data.users + countSingle);
          }
          else {
            $('#count').text(count1 + data.users + count2);
          }
          bool = false;
        }
        else {
          $('#stream').prepend(message2 + data.id + middle + close);
          $('#'+data.id+' p').text(data.content);
          if (data.users === 1) {
            $('#count').text(count1 + data.users + countSingle);
          }
          else {
            $('#count').text(count1 + data.users + count2);
          }
          bool = true;
        }
      });
    </script>
  </body>
</html>
